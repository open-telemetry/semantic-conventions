groups:
  - id: span.rpc.call.client
    type: span
    stability: development
    brief: This span represents an outgoing Remote Procedure Call (RPC).
    note: |
      RPC client spans SHOULD cover the entire client-side lifecycle of an RPC,
      starting when the RPC is initiated and ending when the response is received
      or the RPC is terminated due to an error or cancellation.

      For streaming RPCs, the span covers the full lifetime of the request and/or
      response streams until they are closed or terminated.

      If a transient issue happened and was retried within this RPC, the corresponding
      span SHOULD cover the duration of the logical call with all retries.

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `CLIENT`.
    extends: rpc_service
    span_kind: client
    events: [rpc.message]
    attributes:
      - ref: rpc.system
        requirement_level: required

  - id: span.rpc.call.server
    type: span
    stability: development
    extends: rpc_service.server
    span_kind: server
    brief: This span represents an incoming Remote Procedure Call (RPC).
    events: [rpc.message]
    note: |
      RPC server spans SHOULD cover the entire server-side lifecycle of an RPC,
      starting when the request is received and ending when the response is sent
      or the RPC is terminated due to an error or cancellation.

      For streaming RPCs, the span SHOULD cover the full lifetime of the request
      and/or response streams until they are closed or terminated.

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `SERVER`.
    attributes:
      - ref: rpc.system
        requirement_level: required

  - id: span.rpc.connect_rpc.call.client
    type: span
    stability: development
    brief: This span represents an outgoing Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"connect_rpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `CLIENT`.
    extends: rpc_service
    span_kind: client
    attributes:
      - ref: rpc.connect_rpc.error_code
        requirement_level:
          conditionally_required: if available.
      - ref: rpc.request.metadata
        brief: >
          Connect request metadata, `<key>` being the normalized Connect Metadata key (lowercase), the value being the metadata values.
        requirement_level: opt_in
      - ref: rpc.response.metadata
        brief: >
          Connect response metadata, `<key>` being the normalized Connect Metadata key (lowercase), the value being the metadata values.
        requirement_level: opt_in

  - id: span.rpc.connect_rpc.call.server
    type: span
    stability: development
    extends: rpc_service.server
    span_kind: server
    brief: This span represents an incoming Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"connect_rpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `SERVER`.
    attributes:
      - ref: rpc.connect_rpc.error_code
        requirement_level:
          conditionally_required: if available.
      - ref: rpc.request.metadata
        brief: >
          Connect request metadata, `<key>` being the normalized Connect Metadata key (lowercase), the value being the metadata values.
        requirement_level: opt_in
      - ref: rpc.response.metadata
        brief: >
          Connect response metadata, `<key>` being the normalized Connect Metadata key (lowercase), the value being the metadata values.
        requirement_level: opt_in

  - id: span.rpc.grpc.call.client
    type: span
    stability: development
    brief: This span represents an outgoing Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"grpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `CLIENT`.

      **Span status** Should be set based on the grpc status code. A mapping is defined in the [grpc status](/docs/rpc/grpc.md#grpc-status) section.
    extends: rpc_service
    span_kind: client
    attributes:
      - ref: rpc.method
        requirement_level: required
      - ref: rpc.service
        requirement_level: required
      - ref: rpc.grpc.status_code
        requirement_level: required
      - ref: rpc.request.metadata
        brief: >
          gRPC request metadata, `<key>` being the normalized gRPC metadata key (lowercase), the value being the metadata value.
        requirement_level: opt_in
      - ref: rpc.response.metadata
        brief: >
          gRPC response metadata, `<key>` being the normalized gRPC metadata key (lowercase), the value being the metadata value.
        requirement_level: opt_in

  - id: span.rpc.grpc.call.server
    type: span
    stability: development
    extends: rpc_service.server
    span_kind: server
    brief: This span represents an incoming Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"grpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `SERVER`.

      **Span status** Should be set based on the grpc status code. A mapping is defined in the [grpc status](/docs/rpc/grpc.md#grpc-status) section.
    attributes:
      - ref: rpc.grpc.status_code
        requirement_level: required
      - ref: rpc.request.metadata
        brief: >
          gRPC request metadata, `<key>` being the normalized gRPC metadata key (lowercase), the value being the metadata value.
        requirement_level: opt_in
      - ref: rpc.response.metadata
        brief: >
          gRPC response metadata, `<key>` being the normalized gRPC metadata key (lowercase), the value being the metadata value.
        requirement_level: opt_in

  - id: span.rpc.jsonrpc.call.client
    type: span
    stability: development
    brief: This span represents an outgoing Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"jsonrpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `CLIENT`.
    extends: rpc
    span_kind: client
    attributes:
      - ref: rpc.method
        requirement_level: required
      - ref: rpc.jsonrpc.version
        requirement_level:
          conditionally_required: If other than the default version (`1.0`)
      - ref: rpc.jsonrpc.request_id
        requirement_level: recommended
      - ref: rpc.jsonrpc.error_code
        requirement_level:
          conditionally_required: when available
      - ref: rpc.jsonrpc.error_message
        requirement_level: recommended

  - id: span.rpc.jsonrpc.call.server
    type: span
    stability: development
    extends: rpc.server
    span_kind: server
    brief: This span represents an incoming Remote Procedure Call (RPC).
    note: |
      `rpc.system` MUST be set to `"jsonrpc"` and SHOULD be provided **at span creation time.**

      **Span name:** refer to the [Span Name](/docs/rpc/rpc-spans.md#span-name) section.

      **Span kind** MUST be `SERVER`.
    attributes:
      - ref: rpc.method
        requirement_level: required
      - ref: rpc.jsonrpc.version
        requirement_level:
          conditionally_required: If other than the default version (`1.0`)
      - ref: rpc.jsonrpc.request_id
        requirement_level: recommended
      - ref: rpc.jsonrpc.error_code
        requirement_level:
          conditionally_required: when available
      - ref: rpc.jsonrpc.error_message
        requirement_level: recommended

  - id: event.rpc.message
    type: event
    stability: development
    name: rpc.message
    brief: Describes a message sent or received within the context of an RPC call.
    note: >
      In the lifetime of an RPC stream, an event for each message sent/received on
      client and server spans SHOULD be created. In case of unary calls only one sent
      and one received message will be recorded for both client and server spans.
    attributes:
      - ref: rpc.message.type
        requirement_level: recommended
      - ref: rpc.message.id
        requirement_level: recommended
      - ref: rpc.message.compressed_size
        requirement_level: recommended
      - ref: rpc.message.uncompressed_size
        requirement_level: recommended
